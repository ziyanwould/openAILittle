# MySQL自定义配置文件
# 用于openAILittle项目的性能优化

[mysqld]
# ==================== 字符集配置 ====================
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# ==================== 连接配置 ====================
max_connections = 500
max_connect_errors = 1000
wait_timeout = 600
interactive_timeout = 600

# ==================== 内存优化 ====================
# InnoDB缓冲池 (建议设置为物理内存的50-70%)
innodb_buffer_pool_size = 1G
innodb_buffer_pool_instances = 4

# 排序缓冲区 (解决 ER_OUT_OF_SORTMEMORY 错误)
sort_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 2M
join_buffer_size = 4M

# 临时表配置
tmp_table_size = 64M
max_heap_table_size = 64M

# ==================== 日志配置 ====================
# InnoDB日志文件
innodb_log_file_size = 256M
innodb_log_buffer_size = 16M

# 二进制日志 (可选,用于主从复制)
# log_bin = mysql-bin
# binlog_format = ROW
# expire_logs_days = 7

# 慢查询日志
slow_query_log = 1
slow_query_log_file = /var/lib/mysql/slow-query.log
long_query_time = 2

# ==================== 性能优化 ====================
# 事务提交策略 (2=每秒刷新,性能更好但可能丢失1秒数据)
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# 线程缓存
thread_cache_size = 50

# 查询缓存 (MySQL 8.0已移除,此配置无效但保留注释)
# query_cache_size = 0
# query_cache_type = 0

# 表打开缓存
table_open_cache = 2000
table_definition_cache = 1400

# ==================== 安全配置 ====================
# 禁用符号链接
symbolic-links = 0

# ==================== 其他优化 ====================
# 自动提交
autocommit = 1

# InnoDB并发线程数
innodb_thread_concurrency = 0

# InnoDB I/O容量
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000

[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4
